(function(a){a.fn.calendarSign=function(g){var x=new Date();var k=x.getFullYear();var z=x.getMonth()+1;var q=(z<10)?"0"+z:z;var u=x.getDate();var t=[];var j={};var d=50;var i={year:k,month:z,tableClass:"sign-succ-table",headClass:"",headTrClass:"sign-succ-canlerdar-head",bodyClass:"sign-succ-canlerdar-days",footClass:"sign-canlerdar-footer",signClass:"signed-day",weekName:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],reqUrl:"http://my.zol.com.cn/index.php?c=Ajax_CalendarCheckV3&a=",initCallback:function(){},callback:function(){},from:0};var n=a.extend({},i,g||{});var e=function(C,E){var D=document.createElement("script");if(D.readyState){D.onreadystatechange=function(){if(D.readyState=="loaded"||D.readyState=="complete"){D.onreadystatechange=null;t.push(C);E()}}}else{D.onload=function(){t.push(C);E()}}D.src=C;document.body.appendChild(D)};var h=function(K,G){var M=new Date(K,G,0).getDate();var H=new Date(K,G-1,1).getDay();var J=Math.ceil((M+H)/7);var L="";for(var F=0;F<J;F++){L+="<tr>";for(var E=0;E<7;E++){var D=F*7+E;var I=(D<H||D>M+H-1)?"&nbsp;":D-H+1;var C=(I=="&nbsp;")?"d_0":"d_"+I;L+='<td class="'+C+'">'+I+"</td>"}L+="</tr>"}return L};var b=function(F,C){var E='<table class="'+n.tableClass+'">';E+='<thead align="center">';E+='<tr class="'+n.headTrClass+'">';for(var D=0;D<7;D++){E+="<td>"+n.weekName[D]+"</td>"}E+="</tr></thead>";E+='<tbody align="center" id="calendarBody" class="'+n.bodyClass+'">';E+=h(n.year,n.month);E+="</tbody>";E+='<tfoot align="center" class="'+n.footClass+'"><tr>';E+='<td colspan="7" class="sign-succ-info">\u5df2\u7ecf\u8fde\u7eed\u7b7e\u5230\uff1a<span data-role="signKeepNum" class="sign-succ-count-span j-sign-succ-keep">'+F+"</span>\u5929&nbsp;&nbsp;";E+='\u7d2f\u8ba1\u7b7e\u5230\uff1a<span class="sign-succ-count-span j-sign-succ-count" data-role="signTotalNum">'+C+"</span>\u5929</td>";E+="</tr></tfoot></table>";return E};var r=function(){a("#calendarSignLayer").remove();var C='<div id="calendarSignLayer" class="signed-info" style="display: none;"> <i class="triangle"></i>            <div class="signed-header clearfix">                <span class="signed-today-num">\u4eca\u65e5\u5df2\u6709<b class="z_todaySignNum">0</b>\u4eba\u7b7e\u5230</span>';C+=p()+"</div>";C+='<div class="sign-succ-calendar">                        <div class="sign-succ-calendar-title clearfix">                            <div class="calendar-title-month">                                <div class="calendar-month-prev j-calendar-month-prev" id="calendarPrevMonth">&nbsp;</div>                                <div class="calendar-month-span j-calendar-month" id="calendarDate">'+k+"\u5e74"+q+'\u6708</div>                                <div class="calendar-month-next j-calendar-month-next" id="calendarNextMonth">&nbsp;</div>                            </div>                            <b>\u7b7e\u5230\u65e5\u8bb0</b> </div>';C+=b(0,0);C+="</div></div>";a("[data-role=calendarSignTarget]").append(C);s()};var v=function(C){e("http://icon.zol-img.com.cn/public/js/jQuery.cookie.js",function(){var D=a.cookie("zol:sign:isShowMissTips");if(D||!C){return}var E='<i class="sign-tip-close">\u5173\u95ed</i>';E+=(C>=5)?"\u60a8\u6709\u6f0f\u7b7e\uff0c\u5feb\u6765\u8865\u7b7e\u5427~":"\u6f0f\u7b7e"+C+"\u5929\uff0c\u5feb\u6765\u8865\u7b7e\u5427>>";a("#signMissTips").html(E).fadeIn();a("#signMissTips i").click(function(){a("#signMissTips").fadeOut();a.cookie("zol:sign:isShowMissTips",7,{expires:24,domain:"zol.com.cn"});a("#calendarSignLayer").fadeIn()})})};var l=function(D,F){var C=a("[data-role=signKeepNum]")||a("[data-role=signNeedDays]"),E=C.parent().html();if(!C||!E){return false}if(D!==false){C.parent().html(E.replace(/\u5df2\u7ecf\u8fde\u7eed\u7b7e\u5230/,"\u8ddd\u79bb\u5b8c\u6210\u4efb\u52a1").replace(/signKeepNum/,"signNeedDays"));a("[data-role=signNeedDays]").text(D)}else{C.parent().html(E.replace(/\u8ddd\u79bb\u5b8c\u6210\u4efb\u52a1/,"\u5df2\u7ecf\u8fde\u7eed\u7b7e\u5230").replace(/signNeedDays/,"signKeepNum"));a("[data-role=signKeepNum]").text(F)}return false};var y=function(){var C="initSign&callback=?";a.getJSON(n.reqUrl+C,{},function(G){if(G.isSignIn&&n.from!="cms"){a('[data-role="calendarSign"]').text("\u5df2\u7b7e\u5230");r();c(G.signKeep);o(G.signInfo);n.initCallback()}a(".z_todaySignNum").text(G.signOrder);if(n.from=="cms"){r();c(G.signKeep);o(G.signInfo);if(G.isSignIn){n.initCallback()}var F="getTodaySignTotal&callback=?";a.getJSON(n.reqUrl+F,{},function(H){if(H.info="ok"){a(".z_todaySignNum").text(H.todayTotal)}});a("#calendarSignLayer").show()}l(G.taskNeedDays,G.signKeep);a("[data-role=signTotalNum]").text(G.signTotal);a("[data-role=nextSignScore]").text(G.nextScore);v(G.signMiss)});var E='<div id="missSignTips" class="signed-supplement" style="display:none;"><i class="trangle"></i>\u82b1\u8d3950Z\u91d1\u8c46\u8865\u7b7e</div>';var D='<div id="missSignConfirm" class="signed-supplement signed-supplement-2" style="display:none;"><i class="trangle"></i><a class="cancel" href="###" target="_self">\u53d6\u6d88</a><a class="sure" href="###">\u786e\u5b9a</a></div>';a("body").append(E);a("body").append(D)};var B=function(){var C="";e("http://icon.zol-img.com.cn/public/js/jQuery.cookie.js",function(){var D=a.cookie("zol:sign:signGuide");if(!D){C+='<div class="sign-guide"><span onclick="javascript:$(this).parent().remove();$(\'#calendarSignLayer\').show();">\u6211\u77e5\u9053\u4e86</span></div>';a.cookie("zol:sign:signGuide",1,{expires:24,domain:"zol.com.cn"})}else{C+="";a.cookie("zol:sign:signGuide",1,{expires:24,domain:"zol.com.cn"})}});return C};var p=function(){var C='<div class="signed-rights" id="signKeepRights">	                            <span class="signed-rights-ico signed-rights-ico-1"></span>	                            <span class="signed-rights-ico signed-rights-ico-2"></span>	                            <span class="signed-rights-ico signed-rights-ico-3"></span>	                            <div class="signed-rights-tip signed-rights-tip-1" style="display:none;"><i></i>\u8fde\u7eed\u7b7e\u52302\u5929\u53ef\u591a\u514d\u8d39\u73a91\u6b21\u8f6c\u76d8\uff01</div>	                            <div class="signed-rights-tip signed-rights-tip-2" style="display:none;"><i></i>\u8fde\u7eed\u7b7e\u52305\u5929\u53ef\u83b7\u5f97\u201c\u6d3b\u8dc3\u7cbe\u82f1\u201d\u52cb\u7ae0\uff01</div>	                            <div class="signed-rights-tip signed-rights-tip-3" style="display:none;"><i></i>\u8fde\u7eed\u7b7e\u523015\u5929\u53ef\u8ba9\u540d\u5b57\u53d8\u4e3a\u5c0a\u8d35\u6a59\u8272\uff01</div>	                        </div>';return C};var s=function(){var C="getPrizeInfo&callback=?";a.getJSON(n.reqUrl+C,{},function(E){if(E.info=="ok"){var D='<div class="pro-to-change" id="calendarPrize">				                        <div class="pro-to-change-head">				                            <a href="http://jindou.zol.com/about.html" target="_blank" class="help-link">\u5e2e\u52a9</a>				                            <h4>\u79ef\u5206\u5151\u6362</h4>				                        </div>				                        <div class="pro-intro clearfix">';D+='<a class="pic" href="'+E.goodsUrl+'" target="_blank" ><img width="97" height="60" src="'+E.goodsPic+'" alt=""></a>';D+='<h4><a href="'+E.goodsUrl+'" target="_blank">'+E.goodsName+"</a></h4>";D+="</div></div>";D+='<a class="go-draw" href="'+E.goodsUrl+'" target="_blank">\u5151\u5956</a>';a("#calendarSignLayer").find(".signed-header").after(D)}})};var A=function(){var C="signIn&callback=?";a.getJSON(n.reqUrl+C,{},function(D){if(D.info=="ok"){r();var E=B();a("#calendarSignLayer").before(E);a(".z_todaySignNum").text(D.signOrder);a("[data-role=calendarSign]").text("\u5df2\u7b7e\u5230");l(D.taskNeedDays,D.signKeep);a("[data-role=signTotalNum]").text(D.signTotal);a("[data-role=nextSignScore]").text(D.nextScore);c(D.signKeep);o(D.signInfo);n.callback(D.signScore,D);a("#calendarSignLayer").show()}})};var w=function(G){var E=parseInt(a("#calendarSignLayer #calendarDate").text().substr(0,4));var F=parseInt(a("#calendarSignLayer #calendarDate").text().substr(5,2));var D=parseInt(G.text());var C="missSignIn&callback=?";a.getJSON(n.reqUrl+C,{y:E,m:F,d:D},function(I){if(I.missSign){l(I.taskNeedDays,I.signKeep);a("[data-role=signTotalNum]").text(I.signTotal);a("[data-role=nextSignScore]").text(I.nextScore);var H=parseInt(a("[data-role=jinDouNum]").text());if(!!H){a("[data-role=jinDouNum]").text(parseInt(H-d))}G.removeClass();G.addClass(n.signClass);G.unbind()}else{alert("\u60a8\u7684\u91d1\u8c46\u4e0d\u8db3~")}})};var c=function(D){if(D>=2){a("#signKeepRights .signed-rights-ico-1").addClass("signed-rights-get")}if(D>=5){a("#signKeepRights .signed-rights-ico-2").addClass("signed-rights-get")}if(D>=15){a("#signKeepRights .signed-rights-ico-3").addClass("signed-rights-get")}var C=[1,2,3];a.each(C,function(E,G){var H="#signKeepRights .signed-rights-ico-"+G;var F=".signed-rights-tip-"+G;a(H).hover(function(){a(this).siblings(F).show()},function(){a(this).siblings(F).hide()})});a("#calendarSignLayer").hover(function(){clearTimeout(j.i);clearTimeout(j.m);clearTimeout(j.n);clearTimeout(j.k);a("#calendarSignLayer").show()},function(){j.j=setTimeout(function(){if(n.from!="cms"){a("#calendarSignLayer").hide()}a("#missSignTips").hide();a("#missSignConfirm").hide()},200)});a("#missSignConfirm ,#missSignTips").hover(function(){clearTimeout(j.j);a("#calendarSignLayer").show()},function(){if(n.from=="cms"){return false}j.k=setTimeout(function(){a("#calendarSignLayer").hide()},200)});a("#missSignConfirm").hover(function(){clearTimeout(j.o);a("#calendarSignLayer").show()},function(){a(this).hide();if(n.from=="cms"){return false}j.n=setTimeout(function(){a("#calendarSignLayer").hide()},200)});a("#calendarSignLayer #calendarPrevMonth").bind("click",function(){var F=a("#calendarSignLayer #calendarDate").text();var J=parseInt(F.substring(0,4));var E=parseInt(F.substring(5,7));var I=(E==1)?12:E-1;var H=(E==1)?J-1:J;if(I<10){I="0"+I}if(2013==J&&E==4){return false}var G=h(J,I);a("#calendarBody").empty().append(G);a("#calendarSignLayer #calendarDate").text(H+"\u5e74"+I+"\u6708");m(J,I)});a("#calendarSignLayer #calendarNextMonth").bind("click",function(){var F=a("#calendarSignLayer #calendarDate").text();var J=parseInt(F.substring(0,4));var E=parseInt(F.substring(5,7));var I=(E==12)?1:E+1;var H=(E==12)?J+1:J;if(I<10){I="0"+I}if(k==J&&z==E){return false}var G=h(J,I);a("#calendarBody").empty().append(G);a("#calendarSignLayer #calendarDate").text(H+"\u5e74"+I+"\u6708");m(J,I)})};var m=function(E,D){var C="getSignDaysInfo&callback=?";a.getJSON(n.reqUrl+C,{y:E,m:D},function(F){o(F)})};var o=function(H){var F="";if(typeof H=="object"){a.each(H,function(J,N){var K=".d_"+N.day;var L=a("#calendarBody").find(K);var M="";L.addClass(n.signClass);if(N.resign){M="\u4e8e"+N.check_date.substr(0,10)+"\u8865\u7b7e"}else{M="\u4e8e"+N.time;if(N.order){M+=",\u7b2c"+N.order+"\u4e2a"}M+="\u7b7e\u5230"}L.attr("title",M)});var D=a("#calendarSignLayer #calendarDate").text();var I=parseInt(D.substring(0,4));var C=D.substr(5,2);if(k==I&&q==C){var E=parseInt(u+a("#calendarBody tr").first().find(".d_0").length);var G=a("#calendarBody td").slice(0,E).not(".d_0").not("."+n.signClass)}else{var G=a("#calendarBody td").not(".d_0").not("."+n.signClass)}G.bind({mouseenter:function(){a(this).addClass("date-hover");var K=parseInt(a(this).offset().top)-35;var J=parseInt(a(this).offset().left)-41;if(a(window).width()-parseInt(a(this).offset().left)<=60){J=a(window).width()-117;a("#missSignTips i").css("left","65%")}else{a("#missSignTips i").css("left","50%")}a("#missSignTips").css({top:K,left:J});a("#missSignTips").show()},mouseleave:function(){a(this).removeClass("date-hover");a("#missSignTips").hide()}});G.bind("click",function(){a(this).removeClass("date-hover");a(this).addClass("date-select");a("#missSignTips").hide();F=a(this);var K=parseInt(a(this).offset().top)-35;var J=parseInt(a(this).offset().left)-34;a("#missSignConfirm").css({top:K,left:J});a("#missSignConfirm").show();F.unbind("mouseleave");F.mouseleave(function(){j.o=setTimeout(function(){F.removeClass("date-select");a("#missSignConfirm").hide()},300)});a("#missSignConfirm .sure").unbind();a("#missSignConfirm .sure").click(function(L){L.preventDefault();w(F);a("#missSignConfirm").hide()});a("#missSignConfirm .cancel").click(function(){F.removeClass("date-select");a("#missSignConfirm").hide()});a("#missSignConfirm").mouseleave(function(){F.removeClass("date-select");a("#missSignConfirm").hide()})})}};var f=function(){var C="getTodaySignTotal&callback=?";a.getJSON(n.reqUrl+C,{},function(D){if(D.info="ok"){a(".z_todaySignNum").text(D.todayTotal)}})};return this.each(function(){var C=a(this);y();a(this).bind("click",function(){A()});if(n.from!="cms"){a(this).hover(function(){clearTimeout(j.j);f();a("#calendarSignLayer").show()},function(){j.i=setTimeout(function(){a("#calendarSignLayer").hide()},200)})}})}})(jQuery);